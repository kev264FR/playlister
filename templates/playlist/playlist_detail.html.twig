{% extends "base.html.twig" %}

{% block body %}
<h1 class="text-center">{{playlist.title}}</h1>

{% if app.user == playlist.user or is_granted("ROLE_ADMIN") %}

<a class="btn btn-success btn-lg" href="{{path("content_add", {id: playlist.id})}}">Ajouter item</a>

{% if playlist.public %}
        <a class="btn btn-primary btn-lg" href="{{path("playlist_make_private", {id: playlist.id})}}">Rendre privée</a>
    {% else %}   
        <a class="btn btn-primary btn-lg" href="{{path("playlist_make_public", {id: playlist.id})}}">Rendre public</a>
{% endif %}

{% endif %}

<hr>

<div class="card player">
    <div class="card-header text-center">
        <h5 class="card-title">Lecteur</h5>
    </div>
    <div class="embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item" src="" frameborder="0"
            allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
</div>

<div class="d-flex flex-wrap">
{% for content in playlist.contents %}
<div class="card" style="width: 18rem;">
    <img src="{{content.platform.imgUrl | replace({"_content_": content.contentId})}}" class="card-img-top">
    <div class="card-body">
        <h6>
            {{content.title}}
        </h6>
        <p class="card-text small text-muted">
            ajouté le : {{content.createdAt | date("d/m/Y H:i")}}
        </p>
    </div>
    <a class="btn selectors btn-lg btn-primary" href="#" data-url="{{content.platform.targetUrl ~ content.contentId}}" onclick="handleClick()">Lancer la lecture</a>
    {% if app.user %}
        {% if is_granted("ROLE_ADMIN") or app.user == playlist.user %}
            <a class="btn btn-lg btn-danger" href="{{path("delete_content", {id: content.id})}}">delete</a>
        {% endif %}
    {% endif %}
    
</div>
{% endfor %}
</div>

{% endblock %}

{% block javascripts %}
    {{parent()}}
    <script>
        function handleClick(){
            event.preventDefault()
            let player = $(".player iframe")
            let url = $(event.target).data("url")
            player.attr("src", url)
        }
    </script>
{% endblock %}