{% extends "base.html.twig" %}

{% block body %}
<h1 class="text-center">{{playlist.title}}</h1>

{% if app.user == playlist.user or is_granted("ROLE_ADMIN") %}

<a class="btn btn-success btn-lg" href="{{path("content_add", {id: playlist.id})}}">Ajouter item</a>

{% if playlist.public %}
        <a class="btn btn-primary btn-lg" href="{{path("playlist_make_private", {id: playlist.id})}}">Rendre privée</a>
    {% else %}   
        <a class="btn btn-primary btn-lg" href="{{path("playlist_make_public", {id: playlist.id})}}">Rendre public</a>
{% endif %}

{% endif %}

<hr>

<div class="card player">
    <div class="card-header text-center">
        <h5 class="card-title">Lecteur</h5>
    </div>
    <div class="embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item" src="" frameborder="0"
            allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
</div>

<div class="d-flex flex-wrap">
    {% for content in playlist.contents %}
        <div class="card" style="width: 18rem;">
            <img src="{{content.platform.imgUrl | replace({"_content_": content.contentId})}}" class="card-img-top">
            <div class="card-body">
                <h6>
                    {{content.title}}
                </h6>
                <p class="card-text small text-muted">
                    ajouté le : {{content.createdAt | date("d/m/Y H:i")}}
                </p>
            </div>
            <a class="btn selectors btn-lg btn-primary" href="#" data-url="{{content.platform.targetUrl ~ content.contentId}}" onclick="handleClick()">Lancer la lecture</a>
            {% if app.user %}
                {% if is_granted("ROLE_ADMIN") or app.user == playlist.user %}
                    <a class="btn btn-lg btn-danger" href="{{path("delete_content", {id: content.id})}}">delete</a>
                {% endif %}
            {% endif %}
            
        </div>
    {% endfor %}
</div>
<div>
    <hr>
    <h3 class="text-center">
        Espace commentaire
    </h3>
    {% for comment in playlist.comments %}
    {% if comment.answerFor == null %}
    <hr>
    <div>
        <div class="card">
            <div class="card-header small text-muted">
                <i class="fas fa-minus"></i> {{comment.user.username}}
            </div>
            <div class="card-body">
                <blockquote class="blockquote mb-0">
                    <p>
                        {{comment.text}}
                    </p>
                    <footer class="blockquote-footer">{{comment.createdAt | date("d.m.Y H:i")}}</footer>
                </blockquote>
                <a class="btn btn-primary" href="{{path("answer_comment", {comment_id: comment.id})}}">
                    <i class="fas fa-comment-dots"></i>
                </a>
            </div>
        </div>
        {% for answer in comment.answers %}
            <div class="card">
                <div class="card-header small text-muted">
                    <i class="fas fa-minus"></i>
                     <i class="fas fa-minus"></i>
                     {{answer.user.username}}                    
                </div>
                <div class="card-body">
                    <blockquote class="blockquote mb-0">
                        <p>
                            {{answer.text}}
                        </p>
                        <footer class="blockquote-footer">{{answer.createdAt | date("d.m.Y H:i")}}</footer>
                    </blockquote>
                    <a class="btn btn-primary" href="{{path("answer_comment", {comment_id: comment.id})}}">
                        <i class="fas fa-comment-dots"></i>
                    </a>
                </div>    
            </div>
    </div>
        {% endfor %}
    {% endif %}
    {% endfor %}
        <a class="btn btn-primary btn-lg" href="{{path("comment_playlist", {playlist_id: playlist.id})}}">
            <i class="fas fa-comment-dots"></i>
        </a>
</div>

{% endblock %}

{% block javascripts %}
    {{parent()}}
    <script>
        function handleClick(){
            event.preventDefault()
            let player = $(".player iframe")
            let url = $(event.target).data("url")
            player.attr("src", url)
        }
    </script>
{% endblock %}